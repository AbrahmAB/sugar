#!/bin/sh

init_cursor() {
    # have to reset cursor(metacity sets it on startup)
    # ugly but works
    for i in 1 2 3; do
        sleep 1
        xsetroot -cursor_name left_ptr
    done
}

if test -z "$SUGAR_SCALING"; then
    export SUGAR_SCALING=72
fi

export GTK2_RC_FILES="@prefix@/share/sugar/data/sugar-$SUGAR_SCALING.gtkrc"

# Needed for executing wpa_passphrase
export PATH="$PATH":/sbin:/usr/sbin

if ! test -f "$GTK2_RC_FILES"; then
    echo "sugar: ERROR: Gtk theme for scaling $SUGAR_SCALING not available in path $GTK2_RC_FILES"
    exit 1
fi

# Source debug definitions
if [ -f ~/.sugar/debug ]; then
        . ~/.sugar/debug
fi

echo Xcursor.theme: sugar | xrdb -merge
metacity --no-force-fullscreen &
init_cursor &

exec sugar-session
